{% extends "base.html" %}
{% block title %}TRAX{% endblock %}
{% block head %}
	{{ super() }}
{% endblock %}
{% block body %}
	{{ super() }}
<div class="row">
    <div class="col-md-2">
        <div class="btn-group">
        <div id="hidenav" class="btn" style="float:left"><i class="fa fa-filter"></i></div>
        </div>
        <div class="btn-group">
            <button class="btn btn-default btn-lg active">all</button>
        </div>
        <div class="btn-group">
            {% for tag in tags %}
            <button class="btn btn-default btn-xs">{{ tag }}</button>
            {% endfor %}
        </div>
    </div>
    <div class="col-md-10">
        <div class="row ">
            <div class="col-md-6">
                <button id="createeventbutton" class="btn btn-primary">
			Create an event
		</button>
            </div>
            <div class="col-md-6">
                <span class="legend">Legend:</span>
                <span class="bs-callout bs-callout-default accepted legend">Accepted</span>
                <span class="bs-callout bs-callout-default followedup legend">Followed up</span>
                <span class="bs-callout bs-callout-default suggested legend">Awaiting followup</span>
                {% if user is not none and user.staff == 1 %}
                <button class="bs-callout bs-callout-default rejected legend">Rejected</button>
                {% endif %}
            </div>
            <div class="col-md-12">
                <form action="/rsvp" method=post>
                    {% for submission in submissions %}
                    {{ macros.event_summary(submission, user) }}
                    {% endfor %}
                </form>
            </div>
        </div>
    </div>
	<div id="oops">Oops! There are no events with that tag. Maybe you could <a href="form.html" >create one</a>?</div>
</div>
{% endblock %}
{% block page_script %}
    <script type="text/javascript">

        //Handle collapsing and expanding the navigation

        $("#hidenav").click(function() {
        	if ($("#leftmenu .tag").is(":hidden")) {
        		//$('#hidenav').prependTo('#leftmenu');
        		$("#leftmenu .tag").show('slow');
        		$("#masthead, #report").addClass('withmenu');
        	} else {
        		//$('#hidenav').prependTo('body');
        		$("#leftmenu .tag").hide('slow');
        		$("#masthead, #report").removeClass('withmenu');
        	}
        });

        // Handle clicking on tags.
        var included = [];
        var excluded = [];

        $('.tag').click(function() {

        	var tagname = $(this).text();

        // Toggle tags between three states: Off, Include, and Exclude.

        	if ($(this).hasClass('off')) {
        		if (tagname == "all") {
        			$('.off').add('.exclude').addClass('include').removeClass('off exclude');
        			excluded = [];
        			included = [];
        			$('.include').each(function (i, thetag) { included.push($(thetag).text()); });
        		} else {
        			$(this).removeClass('off').addClass('include');
        			included.push(tagname);
        		}
        	} else if ($(this).hasClass('include')) {
        		if (tagname == "all") {
        			$('.event').hide();
        			$('.include').add('.exclude').addClass('off').removeClass('include exclude');
        			included = [];
        			excluded = [];
        		} else {
        			$(this).removeClass('include').addClass('exclude');
        			included.splice(included.indexOf(tagname), 1);
        			excluded.push(tagname);
        		}
        	} else if ($(this).hasClass('exclude')) {
        		$(this).removeClass('exclude').addClass('off');
        		excluded.splice(excluded.indexOf(tagname), 1);
        	}

        // Show or hide the appropriate events:

        if($('.include').length == 0) { $('#report').hide('slow');
        } else { $('#report').show('slow'); }

        $(included).each(function (i, thetag) {
        	$('.'+thetag).show('slow');
        });
        $(excluded).each(function (i, thetag) {
        	$('.'+thetag).hide(); });

        // Tell the user what they just did.

        /*$(included).each(function (i, thetag) {
        	if (included.inArray(thetag)) {
        	}
        }
        */
        if (included.length > 0 && excluded.length == 0) {
        	$("#info").text("Show "+included.join(", ")+" events ("+$('.event:visible').length+" events total).");
        	if ($('.event:visible').length == 0) {
        		$('#oops').show();
        	} else {
        		$('#oops').hide();
        	}
        } else if (included.length == 0 && excluded.length > 0) {
        	$("#info").text("Hide "+excluded.join(", ")+" events. No tags selected to view.");
        } else if (included.length > 0 && excluded.length > 0) {
        	$("#info").text("Show "+included.join(", ")+" events unless they are also "+excluded.join(", ")+" events ("+$('.event:visible').length+" events total).");
        } else if (included.length == 0 && excluded.length == 0) {
        	$("#info").text("All view settings cleared.");
        }

        });
    </script>
{% endblock %}
